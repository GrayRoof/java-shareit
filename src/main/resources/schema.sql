CREATE TABLE IF NOT EXISTS users (
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    Name VARCHAR(255) NOT NULL,
    Email VARCHAR(512) NOT NULL,
    CONSTRAINT pk_user PRIMARY KEY (ID),
    CONSTRAINT uq_user_email UNIQUE (Email)
);

CREATE TABLE IF NOT EXISTS requests (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    description VARCHAR(512),
    requester_id BIGINT NOT NULL,
    CONSTRAINT pk_request PRIMARY KEY(id),
    CONSTRAINT fk_request_user FOREIGN KEY(requester_id) REFERENCES users(id) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS items (
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    Name VARCHAR(255) NOT NULL,
    Description VARCHAR(512) NOT NULL,
    IsAvailable BOOLEAN,
    OwnerID BIGINT NOT NULL,
    RequestID BIGINT,
    CONSTRAINT pk_item PRIMARY KEY(id),
    CONSTRAINT fk_item_user FOREIGN KEY(OwnerId) REFERENCES users(ID) ON DELETE CASCADE,
    CONSTRAINT fk_item_request FOREIGN KEY(requestID) REFERENCES requests(id) ON DELETE SET NULL
);

CREATE TABLE IF NOT EXISTS bookings (
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    startDate TIMESTAMP WITHOUT TIME ZONE,
    endDate TIMESTAMP WITHOUT TIME ZONE,
    itemID BIGINT NOT NULL,
    bookerID BIGINT NOT NULL,
    status VARCHAR(64) NOT NULL,
    CONSTRAINT pk_booking PRIMARY KEY (id),
    CONSTRAINT fk_booking_item FOREIGN KEY(itemID) REFERENCES items(id) ON DELETE CASCADE,
    CONSTRAINT fk_booking_user FOREIGN KEY(bookerID) REFERENCES users(id) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS comments (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    text VARCHAR(2000),
    itemID BIGINT NOT NULL,
    authorID BIGINT,
    created  TIMESTAMP WITHOUT TIME ZONE NOT NULL,
    CONSTRAINT pk_comment PRIMARY KEY(id),
    CONSTRAINT fk_comment_item FOREIGN KEY(itemID) REFERENCES items(id) ON DELETE CASCADE,
    CONSTRAINT fk_comment_user FOREIGN KEY(authorID) REFERENCES users(id) ON DELETE SET NULL
);